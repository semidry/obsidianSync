### 万维网和域名系统

万维网 (WWW，World Wide Web)，通常称为 Web，是一种信息系统，使文档和其他 Web资源能够通过 Internet 访问。

#### 网络资源
> 面试难度：🌟 面试考核频率：🌟🌟🌟🌟🌟

网络上的资源必须有一个唯一的表示，才可以在网络上被访问。
- uri(uniform resource identifier) 统一资源标识符。
- url(uniform resource location) 统一资源定位符，统指绝对路径。
- urn(uniform resource name) 统一资源名。
三者之间关系为， url 和 urn 分别是 URI 的子集 。

![[Pasted image 20240124101629.png]]

其中 URN 还处于实验阶段，未大范围进行使用，目前使用最多的是 url。url 由三部分组成。

1. 方案，一般是访问资源使用的协议类型，比如http://、https://。
2. 服务器的 web 地址，可以为域名或者 ip 地址 + 端口号，比如 localhost:8080 或者 127.0.0.1:8080。不添加默认为 80 ，这是访问域名不用加端口号的原因 。
3. web 服务器上的某个资源，比如leetbook/read/networks-interview-highlights。

> 注意： url是否以/结尾，意义是不同的，用户无感知的原因是因为服务器自动处理了这种差异。

#### 应用程序体系架构
> 面试难度：🌟 面试考核频率：🌟🌟

应用程序体系体系架构主要分为两种。

- C/S(client/server) ：客户端之间不进行通信，客户端向服务端发送请求获取数据，服务器要一直开机，需要配备大量的数据中心。比如：微信，google，bing等等。
- P2P(peer to peer) ：对等通信，不需要数据中心，没有客户端和服务端的区别，应用程序在间断连接的主机对之间直接通信。主要应用在流量密集型应用。比如：迅雷，bitTorrent，或者在局域网的文件内部共享应用中。
目前大型互联网应用主要采用的是 C/S 架构，导致 P2P 架构逐渐被人遗忘。 C/S 架构又可以细分为 C/S(client/server) 和 B/S(browser/server)，即根据客户端类型划分。

- 本地客户端：速度快，安全，灵活性较高，但是开发成本就高，比如游戏客户端。
- 浏览器：不需要安装，依托于浏览器，安全性较低，成本极低。
目前很多应用既可以通过本地客户端访问也可以通过浏览器使用。比如，微信，outlook等等。

#### web的结构组件
> 面试难度：🌟🌟🌟 面试考核频率：🌟🌟🌟

web 是极为复杂的，不仅只有 client 与 server 之间简单的请求响应 ，还包含了一些特殊的 server ，他们承担着一些特殊的作用。

代理：位于客户端和服务器之间的 http中间实体。
	![[Pasted image 20240124101816.png]]出于安全考虑，通常会将代理做为转发所有 Web 流量的可信任中间节点使用，可以对请求和响应进行过滤。比如，校园网中可以过滤一些不健康的内容，禁止学生进行访问。



网关：连接其他应用程序的特殊 web 服务器。
	![[Pasted image 20240124101823.png]]做为其他服务器的中间实体使用。常用于将 http 流量转化为其他的协议。网关接受请求时就好像自己本身是资源源服务器一样，客户端对此无感知。



隧道： 对 http通信报文进行盲转发的特殊代理。
	![[Pasted image 20240124101830.png]]对两条连接之间的数据进行盲转发，https就是通过隧道实现的。http连接承载加密的安全套接字层`(ssl,secure sockets layer)流量，这样 ssl 流量就可以直接穿过只允许 web 流量通过防火墙，反正亦然。


#### dns域名系统
> 面试难度：🌟🌟🌟 面试考核频率：🌟🌟🌟🌟🌟

域名系统 (dns,domain name system) 是 Internet 或其他 Internet 协议（ip） 网络中计算机、服务和其他资源的分层分布式命名系统。它将各种信息与分配给每个关联实体的域名相关联。最重要的是，它将容易记忆的域名转换为数字ip地址，用于定位和识别具有底层网络协议的计算机服务和设备。

**dns的作用**
在dns 出现之前，互联网中某台主机的唯一标识是这台机器的 ip 地址，但是这种方式记起来很麻烦，人们更喜欢便于记忆的名称。为了解决这个问题，人们需要一种从主机名称到 ip 地址转换的服务，域名系统作为将域名和 ip 地址相互映射的一个分布式数据库，能够使人更方便地访问互联网。

> 小提示：dns域名支持中文字符

**dns 服务器的结构**
dns域名的结构是 xxx.xxx.xxx，是分层的。分为顶级域名（一级域名），二级域名，三级域名 . . . . .

顶级域名会根据国家地区，或者组织进行划分,比如cn（代表中国）、edu（代表教育组织）。二级域名就是在顶级域名前面加前缀,比如 leetcode.cn。也正因为如此，dns服务器的结构是树状的。

域名以及服务器结构

![[Pasted image 20240124101912.png]]

> 注意：映射关系为根域名服务器管理顶级域名，顶级域名服务器管理二级域名，权威域名服务器管理日常使用的网址映射记录。

**dns 的原理**
以一个例子来了解 dns 的工作原理。

假设一个客户端 A，想要查询 a.leetcode.cn 的 ip 地址，考虑缓存的情况。

1. 客户端 A 首先查询本地的 hosts 文件，查询是否有网址映射关系，如果没有，进行下一步查找。
2. 查找本地的 dns 解析器缓存，如果没有进行下一步。
3. 根据 tcp/ip 参数查找设置好的首选 dns 服务器 ip 地址，一般叫做本地 dns 服务器，查询本地 dns 服务器。本地 dns 服务器如果没有，它就会进行下一步操作。
4. 本地dns会访问根服务器 ，然后根据后缀名，从根服务器中查找对应的顶级域名服务器的 ip ，然后以此向下查找域名服务器的 ip ，然后查找网址映射关系,直到找到为止。
![[Pasted image 20240124101935.png]]

> 客户端 A 向本地域名服务器查询为递归查询，本地域名服务器向根域名服务器查询为迭代查询。

**dns 数据传输**
dns 的数据传输是采用 tcp 协议还是 udp 协议 ，或者是其他的什么协议 ？

dns 既采用 udp 协议也采用 tcp 协议:

- dns 是通过 53 端口进行通信，默认是采用 udp 协议进行数据传输的，除了个别情况，也就是说绝大多数情况是采用 udp 进行传输。
- 使用 tcp 传输的情况:
	- 当返回的响应超过的 512 字节（ udp 最大只支持 512 字节的数据）。
	- 区域传送：主域名服务器向辅助域名服务器传送变化的那部分数据。
> 注意: tcp 协议和 tcp 协议是可以同时绑定同一个端口的。
> 区域传输: dns 服务器中数据不总是一成不变的，域名数量是不断增加，而且一些域名对应着的服务器的也是在变化的，所以其实 dns 服务器中的数据是不断增加的，并且随时流动的，所以可以将区域传输简单理解为 dns 服务器之间进行的数据传输。

**dns 域名服务器名称概念**
- 根域名服务器：最高层次的域名服务器，所有的根域名服务器都知道所有的顶级域名服务器的ip地址，全球有 13 个根域名服务器。
- 顶级域名服务器：负责处理所有顶级域名，提供到权威域服务器的映射。
- 授权(权威)域名服务器：提供主机名到 IP 地址间的映射服务
- 主域名服务器：一个或多个区域域名解析工作的主要域名服务器，通常也是一个或多个区域的授权域名服务器。
- 辅助域名服务器：协助主域名服务器提供域名查询服务，在主机很多的情况下，可以有效分担主域名服务器的压力。当主域名服务器故障时，辅助域名服务器能够在数据有效期内继续为主机提供域名解析服务。
### 网页解析全过程
> 面试难度：🌟🌟🌟 面试考核频率：🌟🌟🌟🌟🌟
> 该节为常见面试题，但是涉及细节内容遍布全书，详解请通读全书，这里内容只涉及应用层和传输层部分内容。

![[Pasted image 20240124102100.png]]

1. dns 解析：访问一个网站时，浏览器获得一个域名，通过 dns 服务将域名解析为 ip 地址。
2. tcp 连接：向 Web 服务器发起 tcp 连接请求。
3. 发送 http 请求：浏览器向 Web 服务器发起一个 http 请求，http 协议是建立在 tcp 协议之上的应用层协议，其本质是在建立起的 tcp连接中，按照 http 协议标准发送一个索要网页的请求。
4. 处理请求并返回：服务器获取到客户端的 http 请求后，会根据 http 请求中的内容来决定如何获取相应的文件，并将文件发送给浏览器。
5. 浏览器渲染：浏览器根据响应开始显示页面，首先解析 html 文件构建 DOM 树，然后解析 CSS 文件构建渲染树，等到渲染树构建完成后，浏览器开始布局渲染树并将其绘制到屏幕上。
6. 断开连接：客户端和服务器断开连接。

